# Проверка работы Яндекс.Метрики

## Быстрая проверка в браузере

### 1. Запустите dev-сервер
```bash
pnpm dev
```

### 2. Откройте сайт в браузере
Перейдите на http://localhost:3000

### 3. Откройте консоль разработчика (F12)
В консоли выполните:
```javascript
console.log('Метрика загружена:', typeof window.ym === 'function')
```

Должно вывести: `Метрика загружена: true`

### 4. Проверьте отправку хитов
1. Откройте вкладку Network в DevTools
2. Фильтр: введите `yandex` или `mc.yandex.ru`
3. Перейдите на другую страницу (например, с главной на /posts)
4. Должен появиться запрос к `mc.yandex.ru/watch/...`

### 5. Проверьте передачу параметров
В консоли выполните:
```javascript
window.ym(105076230, 'hit', window.location.pathname, {
  title: document.title
})
```

Должен отправиться запрос в Network.

## Проверка в Яндекс.Метрике

### 1. Войдите в интерфейс Метрики
Откройте https://metrika.yandex.ru

### 2. Выберите счетчик №105076230

### 3. Проверьте онлайн-посетителей
- Перейдите в "Отчеты" → "Стандартные отчеты" → "Посещаемость" → "Онлайн"
- Откройте свой сайт в новой вкладке
- В течение 10-30 секунд должен появиться онлайн-посетитель

### 4. Проверьте просмотры страниц
- Раздел "Контент" → "Страницы"
- После нескольких переходов по сайту должны появиться записи

## Проверка SPA-функциональности

### Тест переходов между страницами
1. Откройте главную страницу
2. Откройте Network → фильтр `watch`
3. Перейдите на другую страницу через меню навигации
4. **Проверка:** должен отправиться новый запрос к `mc.yandex.ru/watch/...`
5. **Ожидаемое поведение:** при каждом переходе отправляется hit

### Проверка Query-параметров
1. Перейдите на `/posts?category=test`
2. В Network должен быть запрос с этим URL
3. Убедитесь, что query-параметры передаются в Метрику

## Отладка

### Включить debug-режим
Временно измените в `src/components/YandexMetrika/index.tsx`:

```typescript
ym(${YANDEX_METRIKA_ID}, "init", {
  defer: true,
  clickmap: true,
  trackLinks: true,
  accurateTrackBounce: true,
  webvisor: true,
  trackHash: true,
  params: {
    __ym: { debug: true }  // Добавьте эту строку
  }
});
```

После этого в консоли будут выводиться все события Метрики с префиксом `[YM]`.

## Частые проблемы

### Метрика не загружается
- Проверьте блокировщики рекламы (отключите AdBlock)
- Проверьте настройки браузера (cookie должны быть включены)
- Проверьте наличие ошибок в Console

### Не отправляются хиты при переходах
- Убедитесь, что `defer: true` в настройках
- Проверьте, что компонент `<YandexMetrika />` добавлен в layout
- Проверьте консоль на наличие ошибок React

### Показывает 0 посетителей в Метрике
- Подождите 1-2 минуты (данные обновляются с задержкой)
- Проверьте, что не заблокированы запросы к `mc.yandex.ru`
- Убедитесь, что используете правильный ID счетчика (105076230)

## Дополнительная информация

Полная документация: `docs/yandex-metrika-integration.md`
