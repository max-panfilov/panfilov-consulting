# –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚úÖ

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–í –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å—á–µ—Ç—á–∏–∫ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ **‚Ññ105076230** —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SPA (Single Page Application).

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **SPA-–∞–¥–∞–ø—Ç–∞—Ü–∏—è** ‚Äî —Å—á–µ—Ç—á–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –≤ Next.js App Router  
‚úÖ **defer: true** ‚Äî —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ö–∏—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å–∞ –¥–ª—è SPA)  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–∫–∏–Ω–≥** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `usePathname` –∏ `useSearchParams` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏  
‚úÖ **TypeScript** ‚Äî –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è API –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏  
‚úÖ **Suspense boundary** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥  

## –í–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- üó∫Ô∏è **–ö–∞—Ä—Ç–∞ –∫–ª–∏–∫–æ–≤** (clickmap)
- üîó **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫** (trackLinks)
- üìä **–¢–æ—á–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–æ–≤** (accurateTrackBounce)
- üìπ **–í–µ–±–≤–∏–∑–æ—Ä** (webvisor) ‚Äî –∑–∞–ø–∏—Å—å –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- #Ô∏è‚É£ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ö—ç—à–∞** (trackHash)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ YandexMetrika/
‚îÇ       ‚îî‚îÄ‚îÄ index.tsx              # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ yandex-metrika.d.ts        # TypeScript —Ç–∏–ø—ã
‚îî‚îÄ‚îÄ app/
    ‚îî‚îÄ‚îÄ (frontend)/
        ‚îî‚îÄ‚îÄ layout.tsx              # –ü–æ–¥–∫–ª—é—á–µ–Ω –≤ layout

docs/
‚îú‚îÄ‚îÄ yandex-metrika-integration.md  # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ yandex-metrika-test.md         # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ
‚îî‚îÄ‚îÄ YANDEX_METRIKA_README.md       # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä
```bash
pnpm dev
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
```javascript
console.log(typeof window.ym) // –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 'function'
```

### 4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
–û—Ç–∫—Ä–æ–π—Ç–µ Network ‚Üí —Ñ–∏–ª—å—Ç—Ä `yandex`  
–î–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å –∫ `mc.yandex.ru/watch/...`

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ú–µ—Ç—Ä–∏–∫–µ
https://metrika.yandex.ru ‚Üí —Å—á–µ—Ç—á–∏–∫ ‚Ññ105076230 ‚Üí "–û–Ω–ª–∞–π–Ω"

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ü–µ–ª–∏ (goal)
```tsx
'use client'

export function MyButton() {
  const handleClick = () => {
    if (window.ym) {
      window.ym(105076230, 'reachGoal', 'button_clicked')
    }
  }

  return <button onClick={handleClick}>–ù–∞–∂–º–∏ –º–µ–Ω—è</button>
}
```

### –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–∏–∑–∏—Ç–∞
```tsx
if (window.ym) {
  window.ym(105076230, 'params', {
    user_type: 'premium',
    page_category: 'services'
  })
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ Client ID
```tsx
if (window.ym) {
  window.ym(105076230, 'getClientID', (clientId) => {
    console.log('Client ID:', clientId)
  })
}
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

üìö **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/yandex-metrika-integration.md`  
üß™ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:** `docs/yandex-metrika-test.md`

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –Ø–Ω–¥–µ–∫—Å–∞ –¥–ª—è SPA:

- ‚úÖ [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è SPA](https://yandex.ru/support/metrica/ru/code/counter-spa-setup)
- ‚úÖ [Yandex Metrica Tag GitHub](https://github.com/yandex/metrica-tag)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Context7 –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã
1. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `defer: true` –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –ø–µ—Ä–≤–æ–≥–æ —Ö–∏—Ç–∞
2. React-—Ö—É–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è `pathname` –∏ `searchParams`
3. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `ym(counterId, 'hit', url)`
4. –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π URL –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
–í—Å–µ –º–µ—Ç–æ–¥—ã API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:
- `YandexMetrikaInitOptions`
- `YandexMetrikaHitOptions`
- `YandexMetrikaFunction`
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `Window` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚ö° –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞: `strategy="afterInteractive"`
- üöÄ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç First Contentful Paint
- üì¶ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ bundle size
- üíØ –ù–µ —É—Ö—É–¥—à–∞–µ—Ç Core Web Vitals

## –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ Next.js build —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω  
‚úÖ Suspense boundary –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–∏–Ω–≥–∞ (–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö)  

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `docs/yandex-metrika-test.md` ‚Äî —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è
2. –í–∫–ª—é—á–∏—Ç–µ debug-—Ä–µ–∂–∏–º (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

**–°—á–µ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!** üéâ

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∞–π—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏.
